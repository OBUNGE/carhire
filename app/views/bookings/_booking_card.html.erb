<% status = booking.status.to_s %>
<% status_classes =
  case status
  when "active"     then "bg-green-100 text-green-800"
  when "completed"  then "bg-blue-100 text-blue-800"
  when "cancelled"  then "bg-red-100 text-red-800"
  else                  "bg-yellow-100 text-yellow-800"
  end
%>

<div class="border rounded-md p-4 shadow-sm bg-white">
  <div class="flex items-start justify-between">
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-1">
        <%= booking.car.name.presence || "#{booking.car.make} #{booking.car.model}" %>
      </h3>

      <% if local_assigns[:show_renter] %>
        <% renter = booking.renter %>
        <p class="text-sm text-gray-600">
          <strong>Renter Name:</strong>
          <%= renter.full_name.presence || "Not provided" %>
        </p>
        <p class="text-sm text-gray-600">
          <strong>Renter Phone:</strong> <%= renter.phone_number %>
        </p>
        <p class="text-sm text-gray-600">
          <strong>Renter Email:</strong> <%= renter.email %>
        </p>
      <% end %>
    </div>

    <span class="inline-flex items-center px-2 py-1 rounded text-sm font-medium <%= status_classes %>">
      <%= status.present? ? status.titleize : "Pending" %>
    </span>
  </div>

  <p class="mt-2">
    <strong>Start Date:</strong>
    <%= booking.start_time&.strftime("%b %d, %Y") %>
  </p>
  <p>
    <strong>End Date:</strong>
    <%= booking.planned_return_at&.strftime("%b %d, %Y") %>
  </p>

  <!-- Quick actions: only render if owner or renter can cancel -->
  <% if local_assigns[:is_owner] || (local_assigns[:is_renter] && booking.cancellable_by?(current_user)) %>

    <%# === TIMER BUTTONS go through booking_actions partial === %>
   <% if local_assigns[:is_owner] && booking.car.listing_type == "rent" %>
  <div id="booking_actions_<%= booking.id %>"
       class="min-h-[2.5rem] flex items-center gap-3">
    <%= render "bookings/booking_actions", booking: booking %>
  </div>
<% end %>


    <div class="mt-3 flex items-center gap-3">
      <%= link_to "View Car", car_path(booking.car), class: "text-blue-600 hover:underline" %>

      <%# Renter's Cancel button %>
      <% if local_assigns[:is_renter] && booking.cancellable_by?(current_user) %>
        <%= button_to "Cancel Booking",
                      booking_path(booking),
                      method: :delete,
                      data: { turbo_confirm: "Are you sure you want to cancel this booking?" },
                      class: "px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" %>
      <% end %>

      <%# Owner's Activate / Cancel buttons (only while pending) %>
      <% if local_assigns[:is_owner] && booking.pending? %>
        <%= link_to "Activate", approve_booking_path(booking),
                    method: :patch,
                    class: "px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" %>
        <%= link_to "Cancel", reject_booking_path(booking),
                    method: :patch,
                    class: "px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" %>
      <% end %>
    </div>

  <% end %> <!-- closes Quick actions if -->
</div>
