<div id="booking_actions_<%= booking.id %>" class="booking-actions">
  <% if booking.rental_start_time.present? && booking.rental_end_time.blank? %>
    <!-- Running: show elapsed + countdown + Stop -->
    <div class="booking-running">
      <!-- Elapsed rental time -->
      <span data-controller="timer"
            data-timer-start-time-value="<%= booking.rental_start_time.iso8601 %>"
            data-timer-target="output"
            class="timer-elapsed">00:00:00</span>

      <!-- Remaining time -->
      <% if booking.planned_return_at.present? %>
        <span data-controller="countdown"
              data-countdown-booking-id-value="<%= booking.id %>"
              data-countdown-until-value="<%= booking.planned_return_at.iso8601 %>"
              data-countdown-urgent-threshold-value="<%= 2.hours * 1000 %>"
              data-countdown-warning-threshold-value="<%= 6.hours * 1000 %>"
              data-countdown-target="output"
              class="timer-remaining">calculatingâ€¦</span>
      <% else %>
        <span class="timer-no-return">No return time set</span>
      <% end %>

      <% if is_owner %>
        <%= button_to "End rental",
                      stop_timer_booking_path(booking),
                      method: :patch,
                      data: { turbo_stream: true },
                      class: "btn btn-danger" %>
      <% end %>
    </div>

  <% elsif booking.rental_end_time.present? %>
    <!-- Stopped: show rental summary -->
    <%= render "bookings/rental_summary", booking: booking, is_owner: is_owner %>

  <% else %>
    <!-- Idle: show Start -->
    <% if is_owner %>
      <%= button_to "Start rental",
                    start_timer_booking_path(booking),
                    method: :patch,
                    data: { turbo_stream: true },
                    class: "btn btn-success" %>
    <% end %>
  <% end %>
</div>

<style>
/* Booking actions styles */
.booking-running {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.timer-elapsed {
  font-family: monospace;
  color: #047857; /* green-700 */
  font-weight: bold;
}

.timer-remaining {
  font-family: monospace;
  color: #374151; /* gray-700 */
}

.timer-no-return {
  color: #6b7280; /* gray-500 */
  font-style: italic;
}

.btn {
  padding: 0.5rem 0.75rem;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  border: none;
}

.btn-success {
  background: #16a34a;
  color: #fff;
}
.btn-success:hover {
  background: #15803d;
}

.btn-danger {
  background: #dc2626;
  color: #fff;
}
.btn-danger:hover {
  background: #b91c1c;
}

</style>
<%# End of booking actions styles %>