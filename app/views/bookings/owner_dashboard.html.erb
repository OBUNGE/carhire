<% current_hour = Time.zone.now.hour %>
<% greeting =
     if current_hour < 12
       "Good morning"
     elsif current_hour < 17
       "Good afternoon"
     else
       "Good evening"
     end %>

<!-- Greeting -->
<div class="dashboard-greeting">
  <h1><%= "#{greeting}, #{current_user.full_name}!" %></h1>
  <p>Welcome back to your dashboard. Let’s get things moving.</p>
</div>

<!-- Dashboard Heading -->
<h1 class="dashboard-heading">Your Car Dashboard</h1>

<!-- Quick Actions -->
<div class="quick-actions">
  <h2>Quick Actions</h2>
  <div class="quick-actions-buttons">
    <%= link_to "List a New Car", new_car_path, class: "btn btn-primary" %>
    <%= link_to "View All Cars", cars_path, class: "btn btn-secondary" %>
    <%= link_to "Edit Profile", edit_user_registration_path, class: "btn btn-tertiary" %>
  </div>
</div>

<!-- Car Stats -->
<div class="car-stats">
  <h2>Your Car Stats</h2>
  <p><strong>Total Cars Listed:</strong> <%= @total_cars %></p>
  <p><strong>Average Price:</strong> KES <%= @average_price.present? ? number_with_precision(@average_price, precision: 2) : "N/A" %></p>
</div>

<!-- Car Listings -->
<% if @cars.any? %>
  <ul class="car-listings">
    <% @cars.each do |car| %>
      <li class="car-card">
        <h2>
          <%= car.name.presence || "#{car.make || 'Unknown Make'} #{car.model || 'Unknown Model'}" %>
          (<%= car.year.presence || "Year N/A" %>)
        </h2>

        <!-- Status Badge -->
        <% if car.status == "published" %>
          <span class="badge badge-published">Published</span>
        <% elsif car.status == "draft" %>
          <span class="badge badge-draft">Draft</span>
        <% elsif car.status == "sold" %>
          <span class="badge badge-sold">Sold</span>
        <% end %>

        <p><strong>Price:</strong>
          <% if car.for_rent? %>
            <span class="price">KES <%= number_to_currency(car.price, unit: '') %> per day</span>
          <% elsif car.for_sale? %>
            <span class="price">KES <%= number_to_currency(car.price, unit: '') %> total</span>
          <% else %>
            Not listed
          <% end %>
        </p>

        <p><strong>Current Listing Type:</strong>
          <span class="listing-type"><%= car.listing_type.present? ? car.listing_type.titleize : "Not specified" %></span>
        </p>

        <!-- Update Form -->
        <div class="update-form">
          <%= form_with model: car, url: car_path(car), method: :patch, local: true do |f| %>
            <%= f.label :listing_type, "Change Listing Type" %>
            <%= f.select :listing_type, Car::LISTING_TYPES.map { |type| [type.titleize, type] }, {}, class: "form-select" %>
            <%= f.submit "Update", class: "btn btn-primary" %>
          <% end %>
        </div>

        <!-- Action Buttons -->
        <div class="car-actions">
          <%= link_to "View", car_path(car), class: "btn btn-light" %>
          <%= link_to "Edit", edit_car_path(car), class: "btn btn-light" %>
          <%= button_to "Delete", car_path(car), method: :delete, data: { turbo_confirm: "Are you sure?" }, local: true, class: "btn btn-danger" %>
        </div>
      </li>
    <% end %>
  </ul>
<% else %>
  <p class="no-cars">You haven’t listed any cars yet.</p>
  <div class="center">
    <%= link_to "List a New Car", new_car_path, class: "btn btn-primary" %>
  </div>
<% end %>

<!-- Purchase Management -->
<%= render "bookings/purchase_management" %>

<% @owner_bookings.each do |booking| %>
  <%= render "bookings/booking_management", booking: booking %>
<% end %>

<style>

/* booking owber dashboard style */

/* Greeting */
.dashboard-greeting {
  background: #2563eb;
  color: white;
  padding: 16px 24px;
  border-radius: 8px;
  margin-bottom: 20px;
}
.dashboard-greeting h1 {
  margin: 0;
  font-size: 24px;
  font-weight: 700;
}
.dashboard-greeting p {
  margin: 4px 0 0;
  font-size: 14px;
  opacity: 0.9;
}

/* Headings */
.dashboard-heading {
  font-size: 30px;
  font-weight: bold;
  text-align: center;
  margin-bottom: 30px;
  color: #1e3a8a;
}

/* Quick Actions */
.quick-actions {
  margin-bottom: 30px;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
}
.quick-actions h2 {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 20px;
  color: #1e3a8a;
}
.quick-actions-buttons {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

/* Car Stats */
.car-stats {
  margin-bottom: 30px;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  text-align: center;
}
.car-stats h2 {
  font-size: 22px;
  font-weight: bold;
  margin-bottom: 20px;
  color: #1e3a8a;
}

/* Car Listings */
.car-listings {
  list-style: none;
  padding: 0;
  margin: 0;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 20px;
}
.car-card {
  border: 1px solid #e5e7eb;
  padding: 20px;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.car-card h2 {
  font-size: 20px;
  font-weight: bold;
  margin-bottom: 8px;
  color: #1e3a8a;
}

/* Status Badges */
.badge {
  font-size: 12px;
  padding: 4px 8px;
  border-radius: 4px;
  font-weight: 600;
  display: inline-block;
  margin-bottom: 6px;
}
.badge-published { background: #e6ffed; color: #065f46; }
.badge-draft { background: #fef2f2; color: #991b1b; }
.badge-sold { background: #fefce8; color: #92400e; }

/* Buttons */
.btn {
  padding: 10px 14px;
  border-radius: 6px;
  font-weight: 500;
  text-align: center;
  text-decoration: none;
  cursor: pointer;
  display: inline-block;
}
.btn-primary { background: #2563eb; color: #fff; }
.btn-secondary { background: #1d4ed8; color: #fff; }
.btn-tertiary { background: #3b82f6; color: #fff; }
.btn-light { background: #f3f4f6; color: #374151; }
.btn-danger { background: #dc2626; color: #fff; }

/* Forms */
.update-form label {
  display: block;
  font-weight: bold;
  margin-bottom: 6px;
  color: #1e3a8a;
}
.form-select {
  padding: 8px;
  width: 100%;
  margin-bottom: 10px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 15px;
}

/* Misc */
.no-cars {
  color: #6b7280;
  font-size: 16px;
  text-align: center;
  margin-bottom: 10px;
}
.center { text-align: center; }
</style>
<%# End of booking owner dashboard style %>
