<% status = purchase.status.to_s %>
<% status_classes =
  case status
  when "approved" then "bg-green-100 text-green-800"
  when "rejected" then "bg-red-100 text-red-800"
  else "bg-yellow-100 text-yellow-800"
  end
%>

<div class="border rounded-md p-4 shadow-sm bg-white">
  <div class="flex items-start justify-between">
    <div>
      <h3 class="text-lg font-semibold text-gray-800 mb-1">
        <%= purchase.car.name.presence || "#{purchase.car.make} #{purchase.car.model}" %>
      </h3>
      <p class="text-sm text-gray-600">
        <strong>Requested on:</strong> <%= purchase.created_at.strftime("%b %d, %Y") %>
      </p>
      <p class="text-sm text-gray-600">
        <strong>Your Message:</strong> <%= purchase.message %>
      </p>
      <p class="text-sm text-gray-600">
        <strong>Contact:</strong>
        <%= purchase.contact_info || "#{purchase.car.user.email} | #{purchase.car.user.try(:phone_number)}" %>
      </p>
    </div>

    <span class="inline-flex items-center px-2 py-1 rounded text-sm font-medium <%= status_classes %>">
      <%= status.present? ? status.titleize : "Pending" %>
    </span>
  </div>

  <div class="mt-3 flex items-center gap-3">
    <%= link_to "View Car", car_path(purchase.car), class: "text-blue-600 hover:underline" %>

    <% if purchase.pending? %>
      <%= button_to "Cancel Request",
                    cancel_purchase_path(purchase),
                    method: :patch,
                    data: { confirm: "Are you sure you want to cancel this request?" },
                    class: "px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600" %>
    <% elsif purchase.cancelled? || purchase.rejected? %>
      <%= button_to "Delete",
                    purchase_path(purchase),
                    method: :delete,
                    data: { confirm: "Are you sure you want to delete this request?" },
                    class: "px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" %>
    <% end %>
  </div>
</div>
