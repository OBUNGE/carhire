<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title><%= content_for?(:title) ? yield(:title) : "Carhire" %></title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="mobile-web-app-capable" content="yes">
  <%= csrf_meta_tags %>
  <%= csp_meta_tag %>

  <%= yield :head %>

  <link rel="icon" href="/icon.png" type="image/png">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="/icon.png">

  <%= stylesheet_link_tag "https://unpkg.com/leaflet/dist/leaflet.css" %>
  <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
  <%= stylesheet_link_tag "custom", "data-turbo-track": "reload" %>

  <%= javascript_include_tag "https://unpkg.com/leaflet/dist/leaflet.js" %>
  <%= javascript_include_tag "application", "data-turbo-track": "reload", type: "module" %>
</head>

<body class="site-body">

  <!-- üîπ Top Navigation Bar -->
<header class="site-header">
  <div class="logo">
    <%= link_to "Carhire", root_path, class: "logo-link" %>
  </div>

  <!-- Hamburger for mobile -->
  <button class="menu-toggle" id="menuToggle" aria-label="Toggle menu">‚ò∞</button>

  <nav class="nav-links" id="navLinks">
    <%= link_to "Home", root_path, class: "nav-link" %>
    <%= link_to "Browse Cars", cars_path, class: "nav-link" %>

    <% if user_signed_in? %>
      <%= link_to "My Bookings", renter_dashboard_path, class: "nav-link" %>
      <% if current_user.owner? || current_user.cars.exists? %>
        <%= link_to "My Listings", owner_dashboard_path, class: "nav-link" %>
      <% end %>
      <%= link_to "Add Car", new_car_path, class: "nav-link" %>
      <%= button_to "Logout", destroy_user_session_path, method: :delete,
          form: { "data-turbo": "true" },
          class: "logout-btn" %>
    <% else %>
      <%= link_to "Log in", new_user_session_path, class: "nav-link" %>
      <%= link_to "Register", new_user_registration_path, class: "nav-link" %>
    <% end %>
  </nav>
</header>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.getElementById("menuToggle");
    const nav = document.getElementById("navLinks");

    toggle.addEventListener("click", () => {
      nav.classList.toggle("open");
    });
  });
</script>


  <!-- üîî Flash Messages -->
  <div id="flash-messages" class="flash-container">
    <% if notice %>
      <div id="notice-message" class="flash flash-notice">
        <span>‚ÑπÔ∏è</span>
        <span><strong>Notice:</strong> <%= notice %></span>
      </div>
    <% end %>
    <% if alert %>
      <div id="alert-message" class="flash flash-alert">
        <span>‚ö†Ô∏è</span>
        <span><strong>Alert:</strong> <%= alert %></span>
      </div>
    <% end %>
  </div>

  <!-- Main Content -->
  <main class="site-main">
    <%= yield %>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <p>¬© <%= Time.current.year %> Carhire. All rights reserved.</p>
  </footer>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      setTimeout(() => {
        const notice = document.getElementById("notice-message");
        const alert = document.getElementById("alert-message");
        if (notice) {
          notice.style.opacity = "0";
          setTimeout(() => notice.remove(), 500);
        }
        if (alert) {
          alert.style.opacity = "0";
          setTimeout(() => alert.remove(), 500);
        }
      }, 4000);
    });
  </script>

</body>
</html>
